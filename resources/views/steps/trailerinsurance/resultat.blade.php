<div class="frame frame-results">
    <div class="frame-contents">
        <div class="frame-resultat-header">
            <div id="resultat-forsakring-price">Ditt pris <span class="price">XXX</span></div>
            <div id="resultat-forsakring-type">Trailerförsäkring</div>
            <div id="resultat-horse-name"><!-- Fabrikat och modell här --></div>
        </div>
        <div class="resultat-widget-points mobile">
            <div>Teckna nu och få</div>
            <div class="resultat-points"><span class="resultat-points-int">XXX</span> poäng</div>
        </div>
        <div class="frame-resultat">
            <div class="frame-resultat-inputs">
                <h2>Välj och anpassa din försäkring</h2>
                <h4>Säkerhetsanordningar <i class="bubble-help btn-sidebar" data-content="sakerhetsanordningar">?</i></h4>
                <p>
                    Lorem ipsum dolor sit amet, consectetur dipiscing elit. Integer sollicitudin est sed iaculis luctus.
                    In est ipsum, mattis venenatis mi eget, varius varius nibh.
                </p>
                <ul class="resultat-slide-select saftey-slide-select options-2">
                    <li class="selected">
                        <input id="saftey-1" class="filter" type="radio" name="saftey" value="1" checked>
                        <label for="saftey-1">Normal</label>
                    </li>
                    <li class="">
                        <input id="saftey-2" class="filter" type="radio" name="saftey" value="2">
                        <label for="saftey-2">Säkerhetsbommar</label>
                    </li>
                    <div class="marker"></div>
                </ul>
                <h4>Försäkringsform <i class="bubble-help btn-sidebar" data-content="trailerforsakring">?</i></h4>
                <p>
                    Lorem ipsum dolor sit amet, consectetur dipiscing elit. Integer sollicitudin est sed iaculis luctus.
                    In est ipsum, mattis venenatis mi eget, varius varius nibh.
                </p>
                <ul class="resultat-slide-select form-slide-select options-2">
                    <li class="selected">
                        <input id="form-1" class="filter" type="radio" name="form" value="grund" checked>
                        <label for="form-1">Grund</label>
                    </li>
                    <li class="">
                        <input id="form-2" class="filter" type="radio" name="form" value="premium">
                        <label for="form-2">Premium</label>
                    </li>
                    <div class="marker"></div>
                </ul>
                <div style="">
                    <div class="resultat-select-caption active" data-type="form">
                        <div class="bullet-lists">
                            <ul class="bullet-list active" data-type="grund" style="width:45%;">
                                <li>Stöld och rån</li>
                                <li>Tvistemål</li>
                                <li>Brand</li>
                                <li>Blixtnedslag</li>
                                <li>Explosion</li>
                                <li>Kortslutning</li>
                            </ul>
                            <ul class="bullet-list" data-type="premium" style="width:45%;">
                                <li>Trafikolycka</li>
                                <li>Skadegörelse</li>
                                <li>Skador orsakade av häst</li>
                                <li>Incident på resa</li>
                            </ul>
                        </div>
                        <div class="compare-table-wrapper">
                            <table class="compare-table compare-table-premium">
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th>Grund</th>
                                        <th>Premium</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <th>Stöld och rån</th>
                                        <td><i class="icon icon-check active" data-type="grund"></i></td>
                                        <td><i class="icon icon-check" data-type="premium"></i></td>
                                    </tr>
                                    <tr>
                                        <th>Tvistemål</th>
                                        <td><i class="icon icon-check active" data-type="grund"></i></td>
                                        <td><i class="icon icon-check" data-type="premium"></i></td>
                                    </tr>
                                    <tr>
                                        <th>Brand</th>
                                        <td><i class="icon icon-check active" data-type="grund"></i></td>
                                        <td><i class="icon icon-check" data-type="premium"></i></td>
                                    </tr>
                                    <tr>
                                        <th>Blixtnedslag</th>
                                        <td><i class="icon icon-check active" data-type="grund"></i></td>
                                        <td><i class="icon icon-check" data-type="premium"></i></td>
                                    </tr>
                                    <tr>
                                        <th>Explosion</th>
                                        <td><i class="icon icon-check active" data-type="grund"></i></td>
                                        <td><i class="icon icon-check" data-type="premium"></i></td>
                                    </tr>
                                    <tr>
                                        <th>Kortslutning</th>
                                        <td><i class="icon icon-check active" data-type="grund"></i></td>
                                        <td><i class="icon icon-check" data-type="premium"></i></td>
                                    </tr>
                                    <tr>
                                        <th>Trafikolycka</th>
                                        <td><i class="icon icon-nope active" data-type="grund"></i></td>
                                        <td><i class="icon icon-check" data-type="premium"></i></td>
                                    </tr>
                                    <tr>
                                        <th>Skadegörelse</th>
                                        <td><i class="icon icon-nope active" data-type="grund"></i></td>
                                        <td><i class="icon icon-check" data-type="premium"></i></td>
                                    </tr>
                                    <tr>
                                        <th>Skador orsakade av häst</th>
                                        <td><i class="icon icon-nope active" data-type="grund"></i></td>
                                        <td><i class="icon icon-check" data-type="premium"></i></td>
                                    </tr>
                                    <tr>
                                        <th>Incident på resa</th>
                                        <td><i class="icon icon-nope active" data-type="grund"></i></td>
                                        <td><i class="icon icon-check" data-type="premium"></i></td>
                                    </tr>
                                </tbody>
                            </table>
                <div class="compare-table-more">
                  <span>Visa mer</span>
                  </div>
                        </div>
                    </div>
                </div>
                <div class="resultat-formansniva" style="display: block;">
                    <!-- Förmånsnivå. Validering mot Focus: moment 22, 26 och 31 -->
                    <h4>Förmånsninvå <i class="bubble-help btn-sidebar" data-content="formansniva">?</i></h4>
                    <p>Eftersom du har både häst och gårdsförsäkring hos oss ger vi dig ett ännu bättre pris.</p>
                </div>

                <div class="resultat-bottom-wrapper">
                    <div class="startdatum-wrapper">
                        <h3>Välj startdatum</h3>
                        <input class="datepicker" type="text" value="{{ $startdatum ?? '' }}" placeholder="åååå-mm-dd" name="startdatum">
                    </div>
                    <div class="uppsagning-options">
                        <h4>Vill du ha hjälp med att säga upp din nuvarande försäkring när den löper ut?</h4>
                        <ul>
                            <li>
                                <input id="uppsagning-1" type="radio" name="uppsagning" value="0" checked>
                                <label for="uppsagning-1">Nej, jag tar hand om det själv</label>
                                <div class="check"></div>
                            </li>
                            <li>
                                <input id="uppsagning-0" type="radio" name="uppsagning" value="1">
                                <label for="uppsagning-0">Ja, det låter bra!</label>
                                <div class="check"></div>
                            </li>
                        </ul>
                        <div class="resultat-select-caption uppsagning-caption">
                            <p style="font-weight:500;">Hur fungerar det?</p>
                            <p>Du får en trygg övergång med trygghetsgaranti där vi överser att allt går rätt till. Du kommer att bli kontaktad av oss inom några dagar. Vi låter dig digitalt signera en uppsägningsfullmakt som vi sedan skickar in precis innan din nya försäkring börjar gälla. Visst är det skönt när det är enkelt?</p>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn1 btn-next btn-full-width resultat-next">Gå vidare</button>
            </div>
        </div>
    </div>
</div>
<div id="resultat-price-mobile">
    Ditt pris <span class="resultat-price"><span class="price">{{ $price['utpris_formaterad'] ?? '' }}</span></span>
</div>
<div id="resultat-widget" class="price-wrapper">
    {!! $price['html'] ?? '' !!}
</div>

@include('steps.trailerinsurance.footer-resultat')
@include('steps.horseinsurance.resultat.popup')
@include('steps.horseinsurance.resultat.pris_scripts')

<script type="text/javascript">
    function update_price()
    {
        var $form = $('#main-form');
        var data = $form.serialize();

        $.post('/step/resultat/get_price', data, function (data) {
            $('.price-wrapper').html(data.html);
            $('.price').html(data.utpris_formaterad);
            $('.resultat-points-int').html(data.points);
            $('.forsakring-enabled-wrapper').html(data.html_boxes);
        }, 'json');
        console.log('update_price');
    }

    function formatNumber(x, seperator) {
        var parts = x.toString().split(".");
        parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, seperator);
        return parts.join(".");
    }

    $(document).ready(function () {
        $('.datepicker').dateDropdowns({
            defaultDateFormat: 'dd-mm-yyyy',
            yearLabel: 'ÅR',
            monthLabel: 'MÅNAD',
            dayLabel: 'DAG',
            maxYear: '{{ today()->addYears(1)->format('Y') }}',
            minYear: '{{ today()->format('Y') }}',
            daySuffixes: false
        });

        $('select').selectric();

        $('.frame-resultat-inputs').on('click', 'input[name=saftey]', function () {
            console.log('AAA');
            var $form = $('#main-form');
            var data = $form.serialize();

            //$.post('/step/resultat/reload_template', data, function (data) {
                //
            //}, 'json');

            $('.saftey-slide-select').find('input[name=saftey]').each(function () {
                $(this).prop('checked', false);
                $(this).parent().removeClass('selected');
            });

            $(this).prop('checked', true);
            $(this).parent().addClass('selected');
        });

        $('.frame-resultat-inputs').on('click', 'input[name=form]', function () {
            console.log('BBB');
            var $form = $('#main-form');
            var data = $form.serialize();

            //$.post('/step/resultat/reload_template', data, function (data) {
                //
            //}, 'json');

            $('.form-slide-select').find('input[name=form]').each(function () {
                $(this).prop('checked', false);
                $(this).parent().removeClass('selected');
            });

            $(this).prop('checked', true);
            $(this).parent().addClass('selected');

            $('.resultat-select-caption[data-type=form] ul').removeClass('active');
            $('.resultat-select-caption[data-type=form] .compare-table i').removeClass('active');

            if ($(this).val() === 'grund') {
                $('.resultat-select-caption[data-type=form] ul[data-type="grund"]').addClass('active');
                $('.resultat-select-caption[data-type=form] i[data-type="grund"]').addClass('active');
            } else if ($(this).val() === 'premium') {
                $('.resultat-select-caption[data-type=form] ul[data-type="grund"]').addClass('active');
                $('.resultat-select-caption[data-type=form] ul[data-type="premium"]').addClass('active');

                $('.resultat-select-caption[data-type=form] i[data-type="grund"]').removeClass('active');
                $('.resultat-select-caption[data-type=form] i[data-type="premium"]').addClass('active');
            }
        });

        // Update price if checkbox is checked/unchecked dummy
        $('.price-wrapper').on('change', 'input', function (e) {
            let name = $(this).attr('name');
            let checked = $(this).prop('checked');
            let value = $(this).val();
            let forsakring_enabled_length = $('.price-wrapper').find('input[name^=forsakring_enabled]:checked').length;

            if (forsakring_enabled_length === 0){
                $('.price-wrapper').find('input[name^=forsakring_enabled]').each(function () {
                    let value2 = $(this).val();
                    if (value !== value2) {
                        $(this).prop('checked', true);
                        return false;
                    }
                });
            }

            if (name === 'forsakring_enabled_dummy[liv]') {
                $('.forsakring-enabled-wrapper').find('input[name=forsakring_enabled\\\[liv\\\]]').prop('checked', checked).trigger('change');
            } else if (name === 'forsakring_enabled_dummy[vet]') {
                $('.forsakring-enabled-wrapper').find('input[name=forsakring_enabled\\\[vet\\\]]').prop('checked', checked).trigger('change');
            }

            // remove or add selected
            if (checked) {
                $(this).removeClass('selected').addClass('selected');
            } else {
                $(this).removeClass('selected');
            }
        });

        $("input[name='uppsagning']").on("change", function () {
            $(".uppsagning-caption").slideToggle(200);
        });

        $('input[name="startdatum"]').on('change', function () {
            update_price();
        });

        $(".compare-table-more").on("click", function() {
            $(".compare-table-more").fadeOut(300);
            $(".compare-table-more").parent().addClass("show");
        });

        // Bugfix
        setTimeout(function () {
            $('input[name=veterinarvardsforsakring]:checked').trigger('click');
        }, 500);
    });
</script>
